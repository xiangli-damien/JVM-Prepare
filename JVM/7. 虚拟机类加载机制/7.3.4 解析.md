
### 概述

解析阶段是将类文件中的==符号引用转换为直接引用的过程==。

### 符号引用和直接引用

- **符号引用（Symbolic References）**：
	- 在*加载* 阶段，被储存在*类文件的常量池中（Constant Pool）* 的符号引用被引入内存中，但是还是不能直接使用， 直到被转化为直接引用。
	
	- 以**一组符号描述所引用的目标**
	- 与虚拟机实现的内存布局无关
	- 目标未必已经加载到内存中
	

- **直接引用（Direct References）**：*可以直接指向目标的指针*、*相对偏移量或句柄*，与虚拟机的内存布局直接相关，目标已存在于内存中。

- 同⼀个符号引⽤在不同虚拟机实例上翻译出来的直接引⽤⼀般不会相同。如果有了直接引⽤，那引⽤的**⽬标必定已经在虚拟机的内存中存在**。 

###  解析时机

- 虚拟机*自行判断*解析动作可以在**类被加载器加载时完成**，或者延迟到**符号引用将要被使用**时才进行。
- 解析必须在特定字节码指令执行前完成。

### 解析动作

包括类或接口、字段、类方法、接口方法、方法类型、方法句柄和调用点限定符7类符号引用的解析，具体包括：

- **类或接口的解析**
	- 类C的加载和初始化。
	- 权限验证，确保调用者有权访问类C。

- **字段解析**
	- 类C的字段解析。
	- 访问权限验证。

- **类方法解析**
	- 类C的方法解析。
	- 访问权限验证。

- **接口方法解析**
	- 接口C的方法解析。
	- JDK 9之前，接口方法默认public，无访问权限问题。JDK 9及以后可能会抛出 `IllegalAccessError`。

### 解析失败的处理
- 解析过程中发生异常，例如 `NoSuchFieldError`、`NoSuchMethodError` 等，将导致解析失败。
- ==对于已解析过的符号引用，虚拟机会缓存其解析结果以避免重复解析。==

###  动态解析
- `invokedynamic` 指令*不适用于前述规则，解析结果不共享，只在运行时解析。*
- 动态调用点限定符的解析完全在运行时动态确定。

### 注意事项
- 符号引用的多次解析应始终得到一致的结果，但 `invokedynamic` 指令除外。
- JDK 9引入模块化后，必须检查模块间的访问权限。
